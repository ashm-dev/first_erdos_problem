# Erdos Solver

Решатель задачи Эрдёша о B-последовательностях — множествах натуральных чисел, у которых все суммы подмножеств различны.

## Задача

**B-последовательность** (или множество Сидона для сумм) — это конечное множество натуральных чисел `{a₁, a₂, ..., aₙ}`, для которого все `2ⁿ` сумм подмножеств попарно различны.

**Цель**: для заданного `n` найти B-последовательность из `n` элементов с минимальным максимальным элементом.

Например, для `n=5` оптимальное решение — `{1, 2, 3, 5, 11}` с максимумом `11`.

## Сборка

Зависимости:
- CMake 3.20+
- Clang (рекомендуется) или GCC
- GMP (GNU Multiple Precision Arithmetic Library)
- SQLite3
- pthreads

```bash
# Arch Linux
sudo pacman -S gmp sqlite cmake clang

# Ubuntu/Debian
sudo apt install libgmp-dev libsqlite3-dev cmake clang
```

Сборка:

```bash
mkdir build && cd build
cmake -DCMAKE_BUILD_TYPE=Release ..
make -j$(nproc)
```

## Использование

```bash
# Решить для конкретного N
./erdos_solver -n 10

# Параллельное решение диапазона N=1..20 в 4 потока
./erdos_solver -s 1 -m 20 -w 4

# Продолжить с последнего решённого N
./erdos_solver -w 4

# Найти все оптимальные решения
./erdos_solver -n 8 --all

# Показать результаты
./erdos_solver --show        # все
./erdos_solver --show 10     # для N=10

# Статистика
./erdos_solver --stats
```

### Опции

| Опция | Описание |
|-------|----------|
| `-n N` | Решить для конкретного N |
| `-s, --start-n N` | Начать с N |
| `-m, --max-n N` | Максимальное N |
| `-w, --workers N` | Число параллельных воркеров |
| `-d, --db PATH` | Путь к БД (по умолчанию: `erdos_results.db`) |
| `-a, --all` | Искать все оптимальные решения |
| `-f, --first-only` | Остановиться на первом решении |
| `--show [N]` | Показать результаты |
| `--stats` | Показать статистику |
| `-v, --verbose` | Подробный вывод |

## Архитектура

```
src/
├── main.c               # CLI, многопоточность
├── backtrack_solver.c   # Алгоритм перебора с возвратом
├── subset_sum_manager.c # Проверка коллизий сумм
├── db_manager.c         # SQLite хранилище
└── logger.c             # Логирование

include/
├── types.h              # Типы данных, MpzSet
├── backtrack_solver.h
├── subset_sum_manager.h
├── db_manager.h
└── logger.h
```

### Алгоритм

1. **Backtracking** с отсечением:
   - Элементы добавляются в порядке возрастания
   - Отсечение по нижней границе: `min_next + remaining >= best_max`
   - Динамическое обновление границы при нахождении решения

2. **SubsetSumManager** — два режима проверки коллизий:
   - **Fast** (`n < 25`): хеш-таблица всех сумм, O(1) проверка
   - **Iterative** (`n >= 25`): без хранения, O(2ⁿ) проверка

3. **Персистентность**: SQLite для сохранения результатов и границ между запусками

## Технологии

- **C23** с расширениями GNU
- **GMP** для произвольно больших чисел
- **SQLite** для хранения результатов
- **mimalloc** — опциональный аллокатор (загружается через FetchContent)
- **pthreads** для параллельной обработки

## Известные результаты

Оптимальные значения max(B) из OEIS A005255:

| n | max(B) |
|---|--------|
| 1 | 1 |
| 2 | 2 |
| 3 | 4 |
| 4 | 7 |
| 5 | 13 |
| 6 | 24 |
| 7 | 44 |
| 8 | 84 |

## Лицензия

Apache License 2.0
